<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>LaTeX Document Set-up with Python’s Jinja Template Engine | austinpursley.com</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="LaTeX Document Set-up with Python’s Jinja Template Engine" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hummingbirds are sorta associted with LaTeX (Calpyte anna, observed by Dario Taraborelli))" />
<meta property="og:description" content="Hummingbirds are sorta associted with LaTeX (Calpyte anna, observed by Dario Taraborelli))" />
<link rel="canonical" href="http://localhost:4000/projects/py-jinja-build-latex.html" />
<meta property="og:url" content="http://localhost:4000/projects/py-jinja-build-latex.html" />
<meta property="og:site_name" content="austinpursley.com" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-06-22T00:00:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="LaTeX Document Set-up with Python’s Jinja Template Engine" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-22T00:00:00-04:00","datePublished":"2022-06-22T00:00:00-04:00","description":"Hummingbirds are sorta associted with LaTeX (Calpyte anna, observed by Dario Taraborelli))","headline":"LaTeX Document Set-up with Python’s Jinja Template Engine","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/projects/py-jinja-build-latex.html"},"url":"http://localhost:4000/projects/py-jinja-build-latex.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/styles.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="austinpursley.com" /></head>
<body>
    <main class="page-content" aria-label="Content">
	
      <div class="wrapper project programming">
	
        <h1>LaTeX Document Set-up with Python's Jinja Template Engine</h1>
<p>22 Jun 2022</p>

<p><img src="/assets/images/Calypte-anna-observed-by-Dario-Taraborelli.webp" alt="" />
<em>Hummingbirds are sorta associted with LaTeX <br /><a href="https://www.inaturalist.org/observations/71999354">(Calpyte anna, observed by Dario Taraborelli)</a>)</em></p>

<p>I’ve learned quite a bit about developing LaTeX documents for work. For long documents, a good set-up is having a main TEX (e.g. main.tex) file import numerous TEX files that correspond to the document sections. The introduction would be one TEX file, an appendix would be another TEX file, etc.</p>

<p>But this can be a somewhat tedious task for setting-up the document at the start of development. Starting a new project with this structure usually involves: copy + pasting a similar Overleaf project, add/removing content as needed, and making tweaks throughout the files so that everything is imported correctly, etc. After all that, then the meat-and-potatoes, the actual document content, can be added. I figured, anything that could be done to get to the good stuff faster, the better.</p>

<h1 id="overall-process--set-up">Overall Process / Set-up</h1>
<p><img src="/assets/images/jinja-build-latex.webp" alt="" />
I’ve automated the set-up with a python script, build.py. The script uses data defined within itself and the .tpl files in the templates folder to build .TEX files. These .TEX files are written to the output directory. The files within the “includes” folder, those document files which are not generated by templates, will be copied as-is to the output directory.</p>

<p>Uploading the project to Overleaf is then as easy as uploading the zipped output folder as a new project.</p>

<p>Below I demonstrate this with a generic example document.</p>

<h1 id="the-templates">The Templates</h1>
<p>There are two templates: one for the main file and one for sub file that are imported into the main file.</p>

<h2 id="maintpl">main.tpl</h2>
<p>This template starts out like a normal LaTeX document set-up. Note the “00aIntroduction” import. That file is not generated by a template, but will be in the “includes” folder.</p>

<figure class="highlight"><pre><code class="language-latex" data-lang="latex"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="code"><pre><span class="c">%===================================================================</span>
<span class="c">% PREAMBLE</span>
<span class="c">%===================================================================</span>

<span class="k">\documentclass</span><span class="p">{</span>myArticleClass<span class="p">}</span>

<span class="k">\title</span><span class="p">{</span>Generic Test Document<span class="p">}</span>
<span class="k">\author</span><span class="p">{</span>Austin Pursley<span class="p">}</span>

<span class="c">%===================================================================</span>
<span class="c">% MAIN DOCUMENT</span>
<span class="c">%===================================================================</span>
 
<span class="nt">\begin{document}</span>
<span class="k">\maketitle</span>
<span class="k">\pagenumbering</span><span class="p">{</span>roman<span class="p">}</span>	
<span class="c">%====================================</span>
<span class="c">% Table of Changes</span>
<span class="k">\clearpage</span>
<span class="k">\import</span><span class="p">{</span>Sections/<span class="p">}{</span>00a<span class="p">_</span>Introduction<span class="p">}</span>

<span class="c">%====================================</span>
<span class="c">% Tables of Contents, Tables, Figures...</span>
<span class="k">\clearpage</span>
<span class="k">\tableofcontents</span>
<span class="k">\newpage</span>
<span class="nt">\begin{center}</span>
<span class="k">\lhead</span><span class="p">{}</span>
<span class="k">\listoftables</span>
<span class="k">\newpage</span>
<span class="k">\listoffigures</span>
<span class="nt">\end{center}</span>
<span class="k">\clearpage</span>

<span class="k">\pagenumbering</span><span class="p">{</span>arabic<span class="p">}</span>
<span class="k">\glsresetall</span> <span class="c">% Resets the acronym markers from preamble</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The next part are the imports for the document sections.</p>

<p>The templating code itself is pretty straight forward. A for loop, in the templating engine syntax, is used to iterate over a dictionary object that holds the section data. This dictionary data is defined within the Python script.</p>

<figure class="highlight"><pre><code class="language-latex" data-lang="latex"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="p">{</span><span class="c">% for s in sections -%}</span>
<span class="p">{</span><span class="c">%- set fn = "{" ~ s.filename ~ "}" -%}</span>
<span class="c">%====================================</span>
<span class="c">% {{ s.title }}</span>
<span class="k">\clearpage</span>
<span class="k">\import</span><span class="p">{</span>Sections/<span class="p">}{{</span> fn <span class="p">}}</span>

<span class="p">{</span><span class="c">% endfor -%}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The template continues and repeats the same templating logic for appendices.</p>

<figure class="highlight"><pre><code class="language-latex" data-lang="latex"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="code"><pre><span class="c">%====================================</span>
<span class="c">% References</span>
<span class="k">\clearpage</span>
<span class="k">\printbibliography</span><span class="na">[heading=bibnumbered,title={References}]</span>
    
<span class="c">%===================================================================</span>
<span class="c">% APPENDICES</span>
<span class="c">%===================================================================</span>

<span class="k">\clearpage</span>
<span class="k">\renewcommand</span><span class="p">{</span><span class="k">\appendixpagename</span><span class="p">}{</span><span class="k">\center</span><span class="p">{</span><span class="k">\Large</span><span class="p">{</span>Appendices<span class="p">}}}</span>
<span class="k">\appendix</span>
<span class="nt">\begin{appendices}</span>
<span class="k">\glsresetall</span> <span class="c">% Resets the acronym markers from main document</span>

<span class="p">{</span><span class="c">% for a in appendices -%}</span>
<span class="p">{</span><span class="c">%- set fn = "{" ~ a.filename ~ "}" -%}</span>
<span class="c">%====================================</span>
<span class="c">% {{ a.title }}</span>
<span class="k">\clearpage</span>
<span class="k">\import</span><span class="p">{</span>Appendices/<span class="p">}{{</span> fn <span class="p">}}</span>

<span class="p">{</span><span class="c">% endfor -%}</span>

<span class="c">%====================================</span>
<span class="c">% Glossaries</span>
<span class="k">\clearpage</span>
<span class="k">\printglossary</span><span class="na">[type=main,style=list]</span>
<span class="k">\printglossary</span><span class="na">[type=abbreviations, title={Acronyms}]</span>
<span class="nt">\end{appendices}</span>

<span class="nt">\end{document}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h2 id="subtpl">sub.tpl</h2>
<p>Sub files will use the template below. It’s essentially a blank page, just a placeholder for an initial set-up.</p>

<figure class="highlight"><pre><code class="language-latex" data-lang="latex"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="p">{</span><span class="c">%- set title = "{" ~ title ~ "}" -%}</span>
<span class="p">{</span><span class="c">%- set label = "{" ~ label ~ "}" -%}</span>
<span class="k">\documentclass</span><span class="na">[class=myArticleClass, float=false, crop=false]</span><span class="p">{</span>standalone<span class="p">}</span>

<span class="c">%=====================================================================</span>
<span class="c">%  {{ title }}</span>
<span class="c">%=====================================================================</span>
<span class="nt">\begin{document}</span>
<span class="k">\section</span><span class="p">{{</span> title <span class="p">}}</span>
<span class="k">\label</span><span class="p">{{</span> label <span class="p">}}</span>
<span class="nt">\end{document}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h1 id="the-build-script">The Build Script</h1>
<p>First, the directories are set-up.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="n">out_dir</span> <span class="o">=</span> <span class="s">"out_doc_0/"</span>
<span class="n">remove_tree</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>
<span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">).</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sec_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">+</span> <span class="s">"Sections/"</span>
<span class="n">apx_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">+</span> <span class="s">"Appendices/"</span>
<span class="n">Path</span><span class="p">(</span><span class="n">sec_dir</span><span class="p">).</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Path</span><span class="p">(</span><span class="n">apx_dir</span><span class="p">).</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Next, the section and appendix data is set-up. Note how only the title names are needed to start with. From these, filenames and labels can be generated.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="c1"># list of document main body document sections and appendices
</span><span class="n">section_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Hipster Ipsum"</span><span class="p">,</span> <span class="s">"Taco Wayfarers"</span><span class="p">]</span>
<span class="n">appendix_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Banjo Greenjuice"</span><span class="p">,</span> <span class="s">"Roof Bar Chia Seeds"</span><span class="p">,</span>
                   <span class="s">"Mumblecore Distillery"</span><span class="p">]</span>

<span class="c1"># build up data from input
</span><span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">section_titles</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">"_"</span> <span class="o">+</span> <span class="n">title</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s">"s"</span> <span class="o">+</span> <span class="n">str2acronym</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">sections</span><span class="p">.</span><span class="n">append</span><span class="p">({</span><span class="s">"title"</span> <span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s">"filename"</span> <span class="p">:</span> <span class="n">filename</span><span class="p">,</span> <span class="s">"label"</span> <span class="p">:</span> <span class="n">label</span><span class="p">})</span>
    
<span class="n">appendices</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">appendix_titles</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">int2alpha</span><span class="p">(</span><span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">"_"</span> <span class="o">+</span> <span class="n">title</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s">"a"</span> <span class="o">+</span> <span class="n">str2acronym</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">appendices</span><span class="p">.</span><span class="n">append</span><span class="p">({</span><span class="s">"title"</span> <span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s">"filename"</span> <span class="p">:</span> <span class="n">filename</span><span class="p">,</span> <span class="s">"label"</span> <span class="p">:</span> <span class="n">label</span><span class="p">})</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"sections"</span> <span class="p">:</span> <span class="n">sections</span><span class="p">,</span>
        <span class="s">"appendices"</span> <span class="p">:</span> <span class="n">appendices</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Then TEX files are created from templates and the data using Jinja.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="c1"># set-up Jinja template environment
</span><span class="n">templateLoader</span> <span class="o">=</span> <span class="n">jinja2</span><span class="p">.</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">searchpath</span><span class="o">=</span><span class="s">"templates/"</span><span class="p">)</span>
<span class="n">templateEnv</span> <span class="o">=</span> <span class="n">jinja2</span><span class="p">.</span><span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">templateLoader</span><span class="p">)</span>
<span class="n">main_temp</span> <span class="o">=</span> <span class="n">templateEnv</span><span class="p">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">"main.tpl"</span><span class="p">)</span>
<span class="n">sub_temp</span> <span class="o">=</span> <span class="n">templateEnv</span><span class="p">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">"sub.tpl"</span><span class="p">)</span>
<span class="c1"># render templates
</span><span class="n">main_TEX</span> <span class="o">=</span> <span class="p">(</span><span class="n">main_temp</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span> <span class="o">+</span> <span class="s">"main.TEX"</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">main_TEX</span><span class="p">)</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"title"</span> <span class="p">:</span> <span class="n">s</span><span class="p">[</span><span class="s">"title"</span><span class="p">],</span>
            <span class="s">"label"</span> <span class="p">:</span> <span class="n">s</span><span class="p">[</span><span class="s">"label"</span><span class="p">]}</span>
    <span class="n">sub_TEX</span> <span class="o">=</span> <span class="p">(</span><span class="n">sub_temp</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sec_dir</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="s">"filename"</span><span class="p">]</span> <span class="o">+</span> <span class="s">".TEX"</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">sub_TEX</span><span class="p">)</span>
        
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">appendices</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"title"</span> <span class="p">:</span> <span class="n">a</span><span class="p">[</span><span class="s">"title"</span><span class="p">],</span>
            <span class="s">"label"</span> <span class="p">:</span> <span class="n">a</span><span class="p">[</span><span class="s">"label"</span><span class="p">]}</span>
    <span class="n">sub_TEX</span> <span class="o">=</span> <span class="p">(</span><span class="n">sub_temp</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">apx_dir</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="s">"filename"</span><span class="p">]</span> <span class="o">+</span> <span class="s">".TEX"</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">sub_TEX</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Finally, the files from the “includes” folder are copied to the output directory (copy/remove tree functions coming from distutils.dir_util).</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="c1"># copy "include" files
</span><span class="n">src_path</span> <span class="o">=</span> <span class="s">'includes'</span>
<span class="n">trg_path</span> <span class="o">=</span> <span class="n">out_dir</span>
<span class="n">copy_tree</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">trg_path</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h1 id="result">Result</h1>
<p>The PDF output result can be seen <a href="/assets/out_doct_0.pdf">here</a>.</p>

<p><a href="https://github.com/austinpursley/py-jinja-setup-latex-doc">GitHub</a> for the code.</p>


      </div>
    </main>
  </body>

</html>
